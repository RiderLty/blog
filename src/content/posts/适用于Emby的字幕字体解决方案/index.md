---
title: é€‚ç”¨äºEmbyçš„å­—å¹•å­—ä½“è§£å†³æ–¹æ¡ˆ
published: 2024-10-23
description: 'ä¸å®‰è£…å­—ä½“ï¼Œä¹Ÿèƒ½æ­£ç¡®æ˜¾ç¤ºå­—å¹•'
image: './cover.png'
tags: [emby,infuse,å­—ä½“,nas]
category: 'NAS'
draft: false 
lang: ''
---

Embyæœ¬è´¨åªæ˜¯ä¸€ä¸ªåª’ä½“æœåŠ¡å™¨è€Œä¸æ˜¯æ’­æ”¾å™¨ï¼Œæ‰€ä»¥è§†é¢‘è¿˜æ˜¯åœ¨ç”¨æœ¬åœ°æ’­æ”¾å™¨æ’­æ”¾ã€‚
å¦‚æœè§†é¢‘çš„å­—å¹•é‡Œç”¨åˆ°äº†ç³»ç»Ÿæœªå®‰è£…çš„å­—ä½“ï¼Œåˆ™ä¼šè°ƒç”¨é»˜è®¤å­—ä½“æ¥æ˜¾ç¤ºã€‚

æ›¾ç»æˆ‘ä¹Ÿæ˜¯ä¸‹è½½äº†Fonts.7zå°±ç›´æ¥åˆ é™¤çš„ï¼Œç›´åˆ°é‡è§äº†ä¸€äº›ç•ªå‰§å­—å¹•æ˜¾ç¤ºæ˜æ˜¾ä¸å¯¹æ‰æ„è¯†åˆ°å¯èƒ½æ˜¯å­—ä½“åˆ°çš„é—®é¢˜ã€‚

ç›®å‰æœ€å¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯å°†å­—å¹•å’Œå­—ä½“éƒ½å°å…¥MKVå®¹å™¨ï¼Œä¾‹å¦‚å–µèŒå¥¶èŒ¶å±‹&LoliHouseçš„ã€Šè´¥çŠ¬å¥³ä¸»å¤ªå¤šäº†ï¼ã€‹ï¼š

![MKVTOOLNIX01](MKVTOOLNIX01.png)

![MKVTOOLNIX02](MKVTOOLNIX02.png)

ä½†æ˜¯æˆ‘çš„ç½‘ç›˜é‡Œè¿˜æœ‰å‡ ç™¾éƒ¨ç•ªå‰§ï¼Œä¸€éƒ¨ä¸€éƒ¨ä¸‹è½½ä¸‹æ¥åµŒå…¥å­—ä½“ä¸Šä¼ å›å»å·¥ä½œé‡å®åœ¨å¤ªå¤§äº†ã€‚

å°±åœ¨æˆ‘æœå¯»è§£å†³åŠæ³•ä¹‹æ—¶ï¼Œçœ‹åˆ°äº†mikusaå¤§ä½¬çš„[æˆ‘çš„åŠ¨ç”»å­—å¹•å­—ä½“è§£å†³æ–¹æ¡ˆ](https://www.himiku.com/archives/my-solution-for-perfect-anime-subtitle-fonts.html)æ‰çŸ¥é“åŸæ¥è¿˜å¯ä»¥åœ¨asså­—å¹•ä¸­åµŒå…¥å­—ä½“ï¼ŒåŒæ—¶ä¹Ÿäº†è§£åˆ°äº†wyzdwdzå¤§ä½¬çš„[assfonts: å­—ä½“æ–‡ä»¶å­é›†åŒ–å·¥å…·ï¼Œæä¾›åµŒå…¥å­—å¹•åŠŸèƒ½](https://bbs.acgrip.com/thread-9897-1-1.html)ã€‚

æœ€åˆçš„æ‰“ç®—æ˜¯å°†æ‰€æœ‰çš„assæ–‡ä»¶éƒ½æ›¿æ¢ä¸ºåµŒå…¥å­—ä½“çš„assï¼Œä½†æ˜¯è¿™æ ·å·¥ä½œé‡å…¶å®ä¹Ÿä¸å°ã€‚

äºæ˜¯ç»“åˆä¹‹å‰åšçš„nginxç›´é“¾çš„æ€è·¯ï¼ŒğŸ¤“â˜ï¸å”‰ï¼ä¸å¦‚æˆ‘ä»¬ç”¨nginxä»£ç†å­—å¹•æ–‡ä»¶çš„æ¥å£ï¼Œå®¢æˆ·ç«¯è¯·æ±‚çš„æ—¶å€™å†å¯¹å­—å¹•è¿›è¡Œå­—ä½“åµŒå…¥ç„¶åæ›¿æ¢åŸæœ¬å†…å®¹è¿”å›ç»™å®¢æˆ·ç«¯ã€‚è¿å­—å¹•æ–‡ä»¶éƒ½ä¸éœ€è¦æ‰‹åŠ¨å¤„ç†ï¼Œç®€ç›´æ‡’äººç¦éŸ³è€¶ã€‚

äºæ˜¯è¿™ä¸ªé¡¹ç›®è¯ç”Ÿäº†ï¼š

::github{repo="RiderLty/fontinass"}

## åŸç†éƒ¨åˆ†

* å°†å­—ä½“å­é›†åŒ–åï¼Œä½¿ç”¨uuencodeç¼–ç ä¸ºæ–‡æœ¬å¹¶åµŒå…¥å­—å¹•ã€‚

* nginxæ‹¦æˆªå­—å¹•è¯·æ±‚ï¼Œå°†åµŒå…¥äº†å­—ä½“çš„å­—å¹•è¿”å›ç»™å®¢æˆ·ç«¯ã€‚

## å®ç°è¿‡ç¨‹

ä½¿ç”¨nginxå°†```/videos/(.*)/Subtitles```çš„å­—å¹•è¯·æ±‚å‘é€è‡³pythonæ­å»ºçš„httpæœåŠ¡å™¨å¤„ç†ã€‚
```nginx
location ~* /videos/(.*)/Subtitles {
    proxy_pass http://127.0.0.1:8011;
}
```

pythonç¨‹åºæ ¹æ®urlå…ˆå»è¯·æ±‚åŸå§‹å­—å¹•æ–‡ä»¶ï¼Œç„¶åè¿›è¡Œå­—ä½“çš„å­é›†åŒ–ä¸åµŒå…¥ã€‚å°†å¤„ç†åçš„å­—å¹•æ–‡ä»¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚

```python
@app.get("/{path:path}")
async def proxy_pass(request: Request, response: Response):
    try:
        host = os.environ.get("EMBY_SERVER_URL") or EMBY_SERVER_URL
        url = (
            f"{request.url.path}?{request.url.query}"
            if request.url.query
            else request.url.path
        )
        embyRequestUrl = host + url
        logger.info(f"å­—å¹•URL:{embyRequestUrl}")
        serverResponse = requests.get(url=embyRequestUrl, headers=request.headers)
        copyHeaders = {key: str(value) for key, value in response.headers.items()}
    except Exception as e:
        info = f"fontinassè·å–åŸå§‹å­—å¹•å‡ºé”™:{str(e)}"
        logger.error(info)
        return info
    try:
        logger.info(f"åŸå§‹å¤§å°:{len(serverResponse.content)}")
        srt, bytes = process(serverResponse.content)
        logger.info(f"å¤„ç†åå¤§å°:{len(bytes)}")
        copyHeaders["Content-Length"] = str(len(bytes))
        if srt:
            if (
                "user-agent" in request.headers
                and "infuse" in request.headers["user-agent"].lower()
            ):
                raise ValueError("infuseå®¢æˆ·ç«¯ï¼Œæ— æ³•ä½¿ç”¨SRTè½¬ASSåŠŸèƒ½ï¼Œè¿”å›åŸå§‹å­—å¹•")
        return Response(content=bytes)
    except Exception as e:
        logger.error(f"å¤„ç†å‡ºé”™ï¼Œè¿”å›åŸå§‹å†…å®¹ : \n{traceback.format_exc()}")
        return Response(content=serverResponse.content)
```

## éƒ¨ç½²

è§githubï¼š[å¿«é€Ÿå¼€å§‹](https://github.com/RiderLty/fontinass?tab=readme-ov-file#%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B)

<iframe width="100%" height="337"src="//player.bilibili.com/player.html?isOutside=true&aid=112988526742369&bvid=BV1e1p2eMEVP&cid=500001654840948&p=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"></iframe>


## PS

å·²å°†VCBçš„[è¶…çº§å­—ä½“æ•´åˆåŒ… XZ ](https://vcb-s.com/archives/1114)ä¸Šä¼ CDNï¼Œç¨‹åºä¼šç›´æ¥è”ç½‘è·å–ï¼Œæ‰€ä»¥å³ä½¿æœ¬åœ°æ²¡æœ‰å­—ä½“ä¹Ÿå¯ä»¥åº”å¯¹å¤§å¤šæ•°å­—å¹•ã€‚